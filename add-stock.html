<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Stock Manager</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      padding: 40px;
    }

    h2 {
      margin-bottom: 15px;
    }

    form, .stock-list {
      background: white;
      padding: 20px;
      max-width: 700px;
      border-radius: 6px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }

    label {
      font-size: 14px;
      margin-top: 10px;
      display: block;
    }

    input, button {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
    }

    button {
      margin-top: 15px;
      background: #2563eb;
      color: white;
      border: none;
      cursor: pointer;
    }

    button:hover {
      background: #1e40af;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th, td {
      padding: 8px;
      border-bottom: 1px solid #ddd;
      text-align: left;
      font-size: 14px;
    }

    .delete-btn {
      background: #dc2626;
      padding: 6px 10px;
      color: white;
      border: none;
      cursor: pointer;
    }

    .delete-btn:hover {
      background: #991b1b;
    }

    a {
      text-decoration: none;
      color: #2563eb;
    }
  </style>
</head>
<body>

  <h2>Add Stock</h2>

  <form id="stockForm">
    <label>Item Name</label>
    <input type="text" id="name" required />

    <label>Total Stock</label>
    <input type="number" id="totalStock" required />

    <label>Current Stock</label>
    <input type="number" id="currentStock" required />

    <label>Unit Price (₹)</label>
    <input type="number" id="price" required />

    <label>Arrival Date</label>
    <input type="date" id="arrivalDate" required />

    <label>Expiry Date</label>
    <input type="date" id="expiryDate" required />

    <button type="submit">Save Stock</button>
  </form>

  <div class="stock-list">
    <h2>Existing Stocks</h2>

    <table>
      <thead>
        <tr>
          <th>Item</th>
          <th>Stock</th>
          <th>Price</th>
          <th>Expiry</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="stockTable"></tbody>
    </table>
  </div>

  <a href="index.html">⬅ Back to Dashboard</a>

  <script>
    const form = document.getElementById("stockForm");
    const stockTable = document.getElementById("stockTable");

    const nameInput = document.getElementById("name");
    const totalStockInput = document.getElementById("totalStock");
    const currentStockInput = document.getElementById("currentStock");
    const priceInput = document.getElementById("price");
    const arrivalDateInput = document.getElementById("arrivalDate");
    const expiryDateInput = document.getElementById("expiryDate");

    // Add stock
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const stockData = {
        name: nameInput.value.trim(),
        totalStock: Number(totalStockInput.value),
        currentStock: Number(currentStockInput.value),
        price: Number(priceInput.value),
        arrivalDate: arrivalDateInput.value,
        expiryDate: expiryDateInput.value
      };

      const res = await fetch("http://localhost:5000/api/stock", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(stockData)
      });

      if (!res.ok) {
        const err = await res.json();
        alert(err.error || "Failed to add stock");
        return;
      }

      form.reset();
      loadStocks();
    });

    // Load stocks
    async function loadStocks() {
      const res = await fetch("http://localhost:5000/api/stock");
      const stocks = await res.json();

      stockTable.innerHTML = "";

      stocks.forEach(stock => {
        const row = document.createElement("tr");

        row.innerHTML = `
          <td>${stock.name || "-"}</td>
          <td>${stock.currentStock}/${stock.totalStock}</td>
          <td>₹${stock.price}</td>
          <td>${new Date(stock.expiryDate).toLocaleDateString()}</td>
          <td>
            <button class="delete-btn" onclick="deleteStock('${stock._id}')">
              Delete
            </button>
          </td>
        `;

        stockTable.appendChild(row);
      });
    }

    // Delete stock
    async function deleteStock(id) {
      if (!confirm("Delete this stock?")) return;

      await fetch(`http://localhost:5000/api/stock/${id}`, {
        method: "DELETE"
      });

      loadStocks();
    }

    // Initial load
    loadStocks();
  </script>

</body>
</html>
